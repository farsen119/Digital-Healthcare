<div class="book-appointment-container">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="appointment-card">
          <!-- Header -->
          <div class="appointment-header">
            <h2 class="appointment-title">
              <i class="fas fa-calendar-plus"></i>
              Book Your Appointment
            </h2>
            <p class="appointment-subtitle">Schedule a consultation with our experienced healthcare professionals</p>
          </div>

          <!-- Form -->
          <form (ngSubmit)="book()" class="appointment-form">
            <!-- Doctor Selection -->
            <div class="form-group">
              <label for="doctor" class="form-label">
                <i class="fas fa-user-md"></i>
                Select Doctor
              </label>
              <select 
                id="doctor"
                [(ngModel)]="form.doctor" 
                name="doctor" 
                class="form-control form-select"
                (ngModelChange)="onDoctorChange()"
                required>
                <option value="" disabled selected>Choose your preferred doctor</option>
                <option *ngFor="let doc of doctors" [value]="doc.id" class="doctor-option">
                  Dr. {{ doc.first_name }} {{ doc.last_name }} - {{ doc.specialization }}
                </option>
              </select>
            </div>

            <!-- Doctor Type Information -->
            <div *ngIf="selectedDoctor" class="doctor-info-alert">
              <div *ngIf="selectedDoctor.doctor_type === 'permanent'" class="alert alert-info">
                <i class="fas fa-users"></i>
                <strong>Permanent Doctor</strong> - This doctor uses a queue system. You'll be added to the queue and consulted when it's your turn.
                <br>
                <small>Current queue position: {{ selectedDoctor.current_queue_position || 0 }}, Max queue size: {{ selectedDoctor.max_queue_size || 10 }}</small>
              </div>
              <div *ngIf="selectedDoctor.doctor_type === 'visiting'" class="alert alert-warning">
                <i class="fas fa-calendar-alt"></i>
                <strong>Visiting Doctor</strong> - This doctor has specific schedules. Please select a date and time slot.
              </div>
            </div>

            <!-- Date and Time Row -->
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="date" class="form-label">
                    <i class="fas fa-calendar"></i>
                    Appointment Date
                  </label>
                  <input 
                    type="date" 
                    id="date"
                    [(ngModel)]="form.date" 
                    name="date" 
                    class="form-control"
                    [required]="selectedDoctor?.doctor_type === 'visiting'">
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <label for="time" class="form-label">
                    <i class="fas fa-clock"></i>
                    Preferred Time
                  </label>
                  <select 
                    id="time"
                    [(ngModel)]="form.time" 
                    name="time" 
                    class="form-control form-select"
                    [required]="selectedDoctor?.doctor_type === 'visiting'">
                    <option value="" disabled selected>Select a time slot</option>
                    <option *ngFor="let slot of timeSlots" [value]="slot" class="time-option">
                      {{ timeSlotService.formatTimeForDisplay(slot) }}
                    </option>
                  </select>
                  <small *ngIf="selectedDoctor && selectedDoctor.consultation_hours" class="form-text text-muted">
                    <i class="fas fa-info-circle"></i>
                    Available hours: {{ selectedDoctor.consultation_hours }}
                  </small>
                </div>
              </div>
            </div>

            <!-- Reason for Visit -->
            <div class="form-group">
              <label for="reason" class="form-label">
                <i class="fas fa-sticky-note"></i>
                Reason for Visit
              </label>
              <textarea 
                id="reason"
                [(ngModel)]="form.reason" 
                name="reason" 
                class="form-control"
                rows="4"
                placeholder="Please describe your symptoms or reason for the appointment..."></textarea>
            </div>

            <!-- Submit Button -->
            <div class="form-actions">
              <button type="submit" class="btn btn-primary btn-book">
                <i class="fas fa-check"></i>
                <span *ngIf="selectedDoctor?.doctor_type === 'permanent'">Join Queue</span>
                <span *ngIf="selectedDoctor?.doctor_type === 'visiting'">Book Appointment</span>
                <span *ngIf="!selectedDoctor">Book Appointment</span>
              </button>
            </div>
          </form>

          <!-- Loading State -->
          <div *ngIf="loading" class="loading-overlay">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p>Booking your appointment...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>