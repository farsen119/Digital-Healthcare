<!-- Admin Registration Form -->
<div class="container-fluid">
  <!-- Dashboard Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-person-plus me-2"></i> Add New User</h2>
    <button class="btn btn-secondary" routerLink="/admin-dashboard">
      <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
    </button>
  </div>

  <!-- Registration Form -->
  <div class="card">
    <div class="card-header bg-dark text-white">
      <h5 class="mb-0"><i class="bi bi-person-plus me-2"></i>User Registration Form</h5>
    </div>
    <div class="card-body">
      <!-- Use #registerForm="ngForm" to create a template-driven form -->
      <form #registerForm="ngForm" (ngSubmit)="register()">
        
        <!-- Account Type (Moved to Top) -->
        <h6 class="text-warning mb-3"><i class="bi bi-shield-check me-2"></i>Account Type</h6>
        <div class="row mb-4">
          <div class="col-md-6">
            <label for="role" class="form-label">Role *</label>
            <select class="form-select" id="role" name="role" [(ngModel)]="form.role" required>
              <option value="">Select Role</option>
              <option value="doctor">Doctor</option>
              <option value="patient">Patient</option>
              <option value="pharmacist">Pharmacist</option>
              <option value="nurse">Nurse</option>
            </select>
          </div>
        </div>

        <!-- Basic Information Section -->
        <h6 class="text-primary mb-3"><i class="bi bi-person me-2"></i>Basic Information</h6>
        
        <!-- First Name and Last Name -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="first_name" class="form-label">First Name *</label>
            <input type="text" id="first_name" name="first_name" [(ngModel)]="form.first_name" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="last_name" class="form-label">Last Name *</label>
            <input type="text" id="last_name" name="last_name" [(ngModel)]="form.last_name" class="form-control" required>
          </div>
        </div>

        <!-- Email, Username, etc. -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="username" class="form-label">Username *</label>
            <input type="text" id="username" name="username" [(ngModel)]="form.username" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="email" class="form-label">Email *</label>
            <input type="email" id="email" name="email" [(ngModel)]="form.email" class="form-control" required>
          </div>
        </div>
        
        <!-- Passwords -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="password" class="form-label">Password *</label>
            <input type="password" id="password" name="password" [(ngModel)]="form.password" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="confirm_password" class="form-label">Confirm Password *</label>
            <input type="password" id="confirm_password" name="confirm_password" [(ngModel)]="form.confirm_password" class="form-control" required>
          </div>
        </div>

        <!-- Contact Information -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="phone" class="form-label">Phone Number *</label>
            <input type="text" id="phone" name="phone" [(ngModel)]="form.phone" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="city" class="form-label">City (Optional)</label>
            <input type="text" id="city" name="city" [(ngModel)]="form.city" class="form-control">
          </div>
        </div>

        <!-- Personal Information -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="age" class="form-label">Age *</label>
            <input type="number" id="age" name="age" [(ngModel)]="form.age" class="form-control" min="1" max="120" required>
          </div>
          <div class="col-md-6 mb-3">
            <label for="gender" class="form-label">Gender *</label>
            <select id="gender" name="gender" [(ngModel)]="form.gender" class="form-select" required>
              <option value="" disabled>Select gender...</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <!-- Doctor Specific Information (Conditional) -->
        <div *ngIf="form.role === 'doctor'">
          <hr class="my-4">
          <h6 class="text-success mb-3"><i class="bi bi-heart-pulse me-2"></i>Medical Information</h6>
          
          <!-- Doctor Type Selection -->
          <div class="row mb-4">
            <div class="col-md-6">
              <label for="doctor_type" class="form-label">Doctor Type *</label>
              <select id="doctor_type" name="doctor_type" [(ngModel)]="form.doctor_type" class="form-select" (ngModelChange)="onDoctorTypeChange()" required>
                <option *ngFor="let type of doctorTypes" [value]="type.value">{{ type.label }}</option>
              </select>
            </div>
          </div>

          <!-- Doctor Type Information Alert -->
          <div class="alert" [ngClass]="form.doctor_type === 'permanent' ? 'alert-info' : 'alert-warning'" role="alert">
            <i class="bi" [ngClass]="form.doctor_type === 'permanent' ? 'bi-people-fill' : 'bi-calendar-event'"></i>
            <strong *ngIf="form.doctor_type === 'permanent'">Permanent Doctor:</strong>
            <strong *ngIf="form.doctor_type === 'visiting'">Visiting Doctor:</strong>
            <span *ngIf="form.doctor_type === 'permanent'">Always available with queue system. Patients join queue and get consulted in order.</span>
            <span *ngIf="form.doctor_type === 'visiting'">Available on specific days only. Patients book appointments with time slots.</span>
          </div>
          
          <!-- Medical Details -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="specialization" class="form-label">Specialization *</label>
              <select id="specialization" name="specialization" [(ngModel)]="form.specialization" class="form-select" required>
                <option value="" disabled>Select a specialization...</option>
                <option *ngFor="let spec of specializations" [value]="spec">{{ spec }}</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="license_number" class="form-label">Medical License Number *</label>
              <input type="text" id="license_number" name="license_number" [(ngModel)]="form.license_number" class="form-control" required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="experience_years" class="form-label">Years of Experience</label>
              <input type="number" id="experience_years" name="experience_years" [(ngModel)]="form.experience_years" class="form-control" min="0" max="50">
            </div>
            <div class="col-md-6 mb-3">
              <label for="qualification" class="form-label">Qualification *</label>
              <input type="text" id="qualification" name="qualification" [(ngModel)]="form.qualification" class="form-control" placeholder="e.g., MBBS, MD, etc." required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="hospital" class="form-label">Hospital/Clinic</label>
              <input type="text" id="hospital" name="hospital" [(ngModel)]="form.hospital" class="form-control">
            </div>
            <div class="col-md-6 mb-3">
              <label for="consultation_fee" class="form-label">Consultation Fee (â‚¹)</label>
              <input type="number" id="consultation_fee" name="consultation_fee" [(ngModel)]="form.consultation_fee" class="form-control" min="0">
            </div>
          </div>

          <div class="mb-3">
            <label for="bio" class="form-label">Professional Bio</label>
            <textarea id="bio" name="bio" [(ngModel)]="form.bio" class="form-control" rows="3" placeholder="Brief description of expertise and experience..."></textarea>
          </div>

                     <!-- Permanent Doctor Schedule Settings -->
           <div *ngIf="form.doctor_type === 'permanent'">
             <hr class="my-3">
             <h6 class="text-primary mb-3"><i class="bi bi-calendar-check me-2"></i>Permanent Schedule Settings</h6>
             <div class="row">
               <div class="col-md-6 mb-3">
                 <label for="available_days" class="form-label">Available Days</label>
                 <select id="available_days" name="available_days" [(ngModel)]="form.available_days" class="form-select">
                   <option value="">Select available days...</option>
                   <option value="Monday-Friday">Monday - Friday</option>
                   <option value="Monday-Saturday">Monday - Saturday</option>
                   <option value="All Days">All Days</option>
                   <option value="Weekends Only">Weekends Only</option>
                 </select>
               </div>
               <div class="col-md-6 mb-3">
                 <label for="consultation_hours" class="form-label">Consultation Hours</label>
                 <input type="text" id="consultation_hours" name="consultation_hours" [(ngModel)]="form.consultation_hours" class="form-control" placeholder="e.g., 9:00 AM - 5:00 PM">
               </div>
             </div>
           </div>

           <!-- Permanent Doctor Queue Settings -->
           <div *ngIf="form.doctor_type === 'permanent'">
             <hr class="my-3">
             <h6 class="text-primary mb-3"><i class="bi bi-people me-2"></i>Queue System Settings</h6>
             <div class="row">
               <div class="col-md-6 mb-3">
                 <label for="max_queue_size" class="form-label">Maximum Queue Size</label>
                 <input type="number" id="max_queue_size" name="max_queue_size" [(ngModel)]="form.max_queue_size" class="form-control" min="1" max="50" placeholder="10">
                 <small class="form-text text-muted">Maximum number of patients that can be in queue at once</small>
               </div>
               <div class="col-md-6 mb-3">
                 <label for="consultation_duration" class="form-label">Consultation Duration (minutes)</label>
                 <input type="number" id="consultation_duration" name="consultation_duration" [(ngModel)]="form.consultation_duration" class="form-control" min="5" max="60" placeholder="15">
                 <small class="form-text text-muted">Average time per consultation for wait time calculation</small>
               </div>
             </div>
           </div>

                     <!-- Visiting Doctor Schedule Settings -->
           <div *ngIf="form.doctor_type === 'visiting'">
             <hr class="my-3">
             <h6 class="text-warning mb-3"><i class="bi bi-calendar-event me-2"></i>Visiting Schedule Settings</h6>
             
             <!-- Visiting Days Selection -->
             <div class="mb-3">
               <label class="form-label">Visiting Days *</label>
               <div class="row">
                 <div class="col-md-3 mb-2" *ngFor="let day of daysOfWeek">
                   <div class="form-check">
                     <input class="form-check-input" type="checkbox" 
                            [id]="'day_' + day.value" 
                            [checked]="isVisitingDaySelected(day.value)"
                            (change)="onVisitingDayChange(day.value, $any($event.target).checked)">
                     <label class="form-check-label" [for]="'day_' + day.value">
                       {{ day.label }}
                     </label>
                   </div>
                 </div>
               </div>
             </div>

             <!-- Visiting Day Time Slots -->
             <div class="mb-3" *ngIf="form.visiting_days.length > 0">
               <label class="form-label">Visiting Day Time Slots *</label>
               <div class="row">
                 <div class="col-md-6 mb-3" *ngFor="let day of daysOfWeek">
                   <div *ngIf="isVisitingDaySelected(day.value)" class="card border-warning">
                     <div class="card-header bg-warning text-dark">
                       <strong>{{ day.label }} Schedule</strong>
                     </div>
                     <div class="card-body">
                       <div class="row">
                         <div class="col-md-6 mb-2">
                           <label class="form-label">Start Time</label>
                           <input type="time" 
                                  class="form-control" 
                                  [(ngModel)]="form.visiting_day_times[day.value].start_time"
                                  name="visiting_start_time_{{ day.value }}"
                                  required>
                         </div>
                         <div class="col-md-6 mb-2">
                           <label class="form-label">End Time</label>
                           <input type="time" 
                                  class="form-control" 
                                  [(ngModel)]="form.visiting_day_times[day.value].end_time"
                                  name="visiting_end_time_{{ day.value }}"
                                  required>
                         </div>
                       </div>
                     </div>
                   </div>
                 </div>
               </div>
             </div>
           </div>
        </div>

        <!-- Pharmacist Specific Information (Conditional) -->
        <div *ngIf="form.role === 'pharmacist'">
          <hr class="my-4">
          <h6 class="text-info mb-3"><i class="bi bi-capsule me-2"></i>Pharmacy Information</h6>
          
          <!-- Pharmacy Name and License -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="pharmacy_name" class="form-label">Pharmacy Name *</label>
              <input type="text" id="pharmacy_name" name="pharmacy_name" [(ngModel)]="form.pharmacy_name" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="pharmacy_license" class="form-label">Pharmacy License Number *</label>
              <input type="text" id="pharmacy_license" name="pharmacy_license" [(ngModel)]="form.pharmacy_license" class="form-control" required>
            </div>
          </div>

          <!-- Pharmacy Address -->
          <div class="row">
            <div class="col-12 mb-3">
              <label for="pharmacy_address" class="form-label">Pharmacy Address *</label>
              <textarea id="pharmacy_address" name="pharmacy_address" [(ngModel)]="form.pharmacy_address" class="form-control" rows="3" required></textarea>
            </div>
          </div>

          <!-- Working Hours and Availability -->
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="working_hours" class="form-label">Working Hours *</label>
              <input type="text" id="working_hours" name="working_hours" [(ngModel)]="form.working_hours" class="form-control" placeholder="e.g., 9:00 AM - 6:00 PM" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="is_available" class="form-label">Availability Status</label>
              <select id="is_available" name="is_available" [(ngModel)]="form.is_available" class="form-select">
                <option [value]="true">Available</option>
                <option [value]="false">Not Available</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Nurse Specific Information (Conditional) -->
        <div *ngIf="form.role === 'nurse'" class="nurse-fields">
          <hr class="my-4">
          <h6 class="text-primary mb-3"><i class="bi bi-person-plus me-2"></i>Nurse Information</h6>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="nurse_license" class="form-label">Nurse License Number *</label>
              <input type="text" id="nurse_license" name="nurse_license" [(ngModel)]="form.nurse_license" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="nursing_qualification" class="form-label">Nursing Qualification *</label>
              <input type="text" id="nursing_qualification" name="nursing_qualification" [(ngModel)]="form.nursing_qualification" class="form-control" placeholder="e.g., BSc Nursing, GNM" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="nurse_specialization" class="form-label">Specialization *</label>
              <input type="text" id="nurse_specialization" name="nurse_specialization" [(ngModel)]="form.nurse_specialization" class="form-control" placeholder="e.g., ICU, Emergency, Pediatric" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="nurse_experience_years" class="form-label">Years of Experience *</label>
              <input type="number" id="nurse_experience_years" name="nurse_experience_years" [(ngModel)]="form.nurse_experience_years" class="form-control" min="0" max="50" required>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="hospital_assignment" class="form-label">Hospital Assignment *</label>
              <input type="text" id="hospital_assignment" name="hospital_assignment" [(ngModel)]="form.hospital_assignment" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="shift_preference" class="form-label">Shift Preference *</label>
              <select id="shift_preference" name="shift_preference" [(ngModel)]="form.shift_preference" class="form-select" required>
                <option value="">Select Shift</option>
                <option value="day">Day Shift</option>
                <option value="night">Night Shift</option>
                <option value="rotating">Rotating Shift</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Profile Photo -->
        <hr class="my-4">
        <h6 class="text-info mb-3"><i class="bi bi-image me-2"></i>Profile Photo</h6>
        <div class="mb-3">
          <label for="photo" class="form-label">Profile Photo (Optional)</label>
          <input type="file" id="photo" name="photo" (change)="onFileChange($event)" class="form-control" accept="image/*">
        </div>

        <!-- Submit Buttons -->
        <hr class="my-4">
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary flex-fill" [disabled]="registerForm.invalid">
            <i class="bi bi-person-plus me-2"></i>Add User
          </button>
          <button type="button" class="btn btn-secondary" routerLink="/admin-dashboard">
            <i class="bi bi-arrow-left me-2"></i>Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
